(()=>{"use strict";var e={167:e=>{e.exports=require("axios")},53:e=>{e.exports=require("canny-edge-detector")},233:e=>{e.exports=require("image-js")},210:e=>{e.exports=require("nedb")},671:e=>{e.exports=require("regenerator-runtime")},147:e=>{e.exports=require("fs")}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("path");var t=n.n(e);const s=require("express");var r=n.n(s);function a(e,t,n,s,r,a,o){try{var i=e[a](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(s,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(s,r){var o=e.apply(t,n);function i(e){a(o,s,r,i,c,"next",e)}function c(e){a(o,s,r,i,c,"throw",e)}i(void 0)}))}}var i=n(671),c=n(147),u=n(167).default,p=n(210),d=n(53),l=n(233).Image,m=process.env.PORT||5e3,g=r()(),f=__dirname,v=t().resolve(f,"../../dist/client/index.html");g.use(r().static(t().resolve(f,"../"))),g.use(r().json({limit:"10mb"})),g.get("/",(function(e,t){t.sendFile(v)})),g.listen(m,(function(){console.log("Listening at ".concat(m))}));var x=new p("./src/server/db/citiesDatabase.db");function b(e){return h.apply(this,arguments)}function h(){return h=o(i.mark((function e(t){var n,s,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c.existsSync("./dist/client/assets/tempImages/image.png")&&c.unlink("./dist/client/assets/tempImages/image.png",(function(e){if(e)throw e})),c.existsSync("./dist/client/assets/tempImages/edge.png")&&c.unlink("./dist/client/assets/tempImages/edge.png",(function(e){if(e)throw e})),n="./dist/client/assets/tempImages",c.existsSync(n)||c.mkdirSync(n),e.next=7,u({method:"get",url:t,responseType:"arraybuffer"});case 7:return s=e.sent,e.next=10,s.data;case 10:return r=e.sent,e.t0=c,e.next=14,r;case 14:e.t1=e.sent,e.t2=function(){var e=o(i.mark((function e(t){var n,s,r,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}throw t;case 2:return e.next=4,l.load("./dist/client/assets/tempImages/image.png");case 4:return n=e.sent,e.next=7,n.grey();case 7:return s=e.sent,r={lowThreshold:120,highThreshold:130,gaussianBlur:.6,brightness:.8},e.next=11,d(s,r);case 11:return a=e.sent,e.abrupt("return",a.save("./dist/client/assets/tempImages/edge.png"));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.t0.writeFile.call(e.t0,"./dist/client/assets/tempImages/image.png",e.t1,e.t2),e.next=23;break;case 19:e.prev=19,e.t3=e.catch(0),console.log("error 8"),b(t);case 23:case"end":return e.stop()}}),e,null,[[0,19]])}))),h.apply(this,arguments)}x.loadDatabase(),g.get("/bkgImage/:cityname",function(){var e=o(i.mark((function e(t,n){var s,r,a,o,c,p,d,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.params.cityname,e.prev=1,a="https://pixabay.com/api/?key=".concat("14002767-fc7a727782d5b5a6b70bdeb00","&q=").concat(s,"&category=places&image_type=photo&orientation=horizontal"),e.next=6,u.get(a);case 6:return o=e.sent,e.next=9,o.data;case 9:return c=e.sent,e.next=12,c.hits[0].largeImageURL;case 12:r=e.sent,console.log(r),n.json(c),b(r),e.next=39;break;case 18:return e.prev=18,e.t0=e.catch(1),e.prev=20,p="https://api.teleport.org/api/urban_areas/slug:".concat(s.toLowerCase(),"/images/"),e.next=24,u.get(p);case 24:return d=e.sent,e.next=27,d.data;case 27:return l=e.sent,e.next=30,l.photos[0].image.web;case 30:r=e.sent,n.json(l),b(r),e.next=39;break;case 35:e.prev=35,e.t1=e.catch(20),console.log("error 7"),n.json(e.t1.data);case 39:case"end":return e.stop()}}),e,null,[[1,18],[20,35]])})));return function(t,n){return e.apply(this,arguments)}}()),g.post("/queryDb",(function(e,t){x.loadDatabase();var n=e.body;x.find({name:n.name},(function(e,s){e?t.end():0==s.length?t.json({status:"success",action:"Not in database",name:n.name}):t.json({status:"success",action:"read from db",name:n.name,title:s[0].title,data:s[0].data})}))})),g.post("/saveDb",(function(e,t){var n=e.body;x.insert(n),t.json({status:"success",action:"saved on database",name:n.name})})),g.get("/menu",(function(e,t){x.find({},(function(e,n){t.json({status:"success",action:"reading from db",data:n})}))})),g.post("/cancelDb",(function(e,t){var n=e.body.name;x.find({name:n},(function(e,n){x.remove({_id:n[0]._id},(function(e,n){t.json({status:"success",action:"cancel from db",data:n})}))}))}))})()})();