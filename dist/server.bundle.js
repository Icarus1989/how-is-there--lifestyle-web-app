(()=>{"use strict";var e={167:e=>{e.exports=require("axios")},53:e=>{e.exports=require("canny-edge-detector")},31:e=>{e.exports=require("cross-fetch")},233:e=>{e.exports=require("image-js")},210:e=>{e.exports=require("nedb")},671:e=>{e.exports=require("regenerator-runtime")},147:e=>{e.exports=require("fs")}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("path");var t=n.n(e);const r=require("express");var a=n.n(r);function s(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){s(o,r,a,c,i,"next",e)}function i(e){s(o,r,a,c,i,"throw",e)}c(void 0)}))}}var c=n(671),i=n(147),u=n(31),p=n(167).default,d=n(210),l=n(53),f=n(233).Image;console.log(t().resolve(__dirname,"../"));var v=a()(),m=__dirname,g=t().resolve(m,"client/index.html");v.use(a().static(m)),v.use(a().json({limit:"10mb"})),v.get("/",(function(e,t){t.sendFile(g)}));var b=process.env.PORT||5e3;v.listen(b,(function(){console.log("Listening at ".concat(b))}));var x=new d("./src/server/db/citiesDatabase.db");function h(e){return y.apply(this,arguments)}function y(){return(y=o(c.mark((function e(t){var n,r,a,s;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n="./dist/client/assets/tempImages",i.existsSync(n)||i.mkdirSync(n),e.prev=3,i.unlinkSync("".concat(n,"/image.png")),i.unlinkSync("".concat(n,"/edge.png")),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),console.error(e.t0),e.abrupt("return");case 12:return e.next=14,u(t);case 14:return r=e.sent,a=r.buffer(),e.t1=i,e.t2="".concat(n,"/image.png"),e.next=20,a;case 20:return e.t3=e.sent,e.t4=o(c.mark((function e(){var t,r,a,s;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.load("".concat(n,"/image.png"));case 2:return t=e.sent,e.next=5,t.grey();case 5:return r=e.sent,a={lowThreshold:120,highThreshold:130,gaussianBlur:.6,brightness:.8},e.next=9,l(r,a);case 9:return s=e.sent,console.log(s),e.abrupt("return",s.save("".concat(n,"/edge.png")));case 12:case"end":return e.stop()}}),e)}))),s=e.t1.writeFile.call(e.t1,e.t2,e.t3,e.t4),e.abrupt("return",s);case 26:e.prev=26,e.t5=e.catch(0),h(t);case 29:case"end":return e.stop()}}),e,null,[[0,26],[3,8]])})))).apply(this,arguments)}x.loadDatabase(),v.get("/bkgImage/:cityname",function(){var e=o(c.mark((function e(t,n){var r,a,s,o,i,u,d,l;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params.cityname,e.prev=1,s="https://pixabay.com/api/?key=".concat("14002767-fc7a727782d5b5a6b70bdeb00","&q=").concat(r,"&category=travel&image_type=photo"),e.next=6,p.get(s);case 6:return o=e.sent,e.next=9,o.data;case 9:return i=e.sent,e.next=12,i.hits[0].largeImageURL;case 12:a=e.sent,n.json(i),h(a),e.next=37;break;case 17:return e.prev=17,e.t0=e.catch(1),e.prev=19,u="https://api.teleport.org/api/urban_areas/slug:".concat(r.toLowerCase(),"/images/"),e.next=23,p.get(u);case 23:return d=e.sent,e.next=26,d.data;case 26:return l=e.sent,e.next=29,l.photos[0].image.web;case 29:a=e.sent,n.json(l),h(a),e.next=37;break;case 34:e.prev=34,e.t1=e.catch(19),n.json(e.t1.data);case 37:case"end":return e.stop()}}),e,null,[[1,17],[19,34]])})));return function(t,n){return e.apply(this,arguments)}}()),v.post("/queryDb",(function(e,t){x.loadDatabase();var n=e.body;x.find({name:n.name},(function(e,r){e?t.end():0==r.length?t.json({status:"success",action:"Not in database",name:n.name}):t.json({status:"success",action:"read from db",name:n.name,title:r[0].title,data:r[0].data})}))})),v.post("/saveDb",(function(e,t){var n=e.body;x.insert(n),t.json({status:"success",action:"saved on database",name:n.name})})),v.get("/menu",(function(e,t){x.find({},(function(e,n){t.json({status:"success",action:"reading from db",data:n})}))})),v.post("/cancelDb",(function(e,t){var n=e.body.name;x.find({name:n},(function(e,n){x.remove({_id:n[0]._id},(function(e,n){t.json({status:"success",action:"cancel from db",data:n})}))}))}))})()})();